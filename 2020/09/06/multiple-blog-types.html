<p><code class="language-plaintext highlighter-rouge">graphql</code> is was very confusing for me to use at first, but with the <code class="language-plaintext highlighter-rouge">___graphql</code> tool available during <code class="language-plaintext highlighter-rouge">gatsby develop</code>, I found that I could quickly learn how it works as I used it more and more. One of the issues I came across lately was trying to maintain two different markdown folders for blogs and projects respectively.</p>

<p>From my research, I found another guide on how to do this, but their guide was for gatsby version 1, and I found that the requirement of providing metadata for project markdown files was a bit redundant, as you will see below. So here is my guide for creating a projects folder for your project markdown files to be serve on gatsby.</p>

<h1 id="criteria">Criteria</h1>

<ul>
  <li>You are using a set up similar to the the <a href="https://www.gatsbyjs.com/starters/gatsbyjs/gatsby-starter-blog/">gatsby starter blog</a>.</li>
  <li>You want a file structure like this</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src
├── content
│   ├── blog
│   │   ├── blog1
│   │   │   └── index.md
│   │   └── blog2
│   │       └── index.md
│   └── projects
│       ├── project1
│       │   └── index.md
│       └── project2
│           └── index.md
└── src
    └── templates
        ├── BlogPost.tsx
        └── ProjectPost.tsx
</code></pre></div></div>

<p>Thats it! (nothing redundant like requiring a field to be added to each projects’ <code class="language-plaintext highlighter-rouge">index.md</code>…)</p>

<h1 id="setting-up-gatsby">Setting up Gatsby</h1>

<p>In <code class="language-plaintext highlighter-rouge">gatsby-config.js</code>, add the following code in the plugins array:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">plugins</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">...</span>
    <span class="p">{</span>
      <span class="nl">resolve</span><span class="p">:</span> <span class="s2">`gatsby-source-filesystem`</span><span class="p">,</span>
      <span class="nx">options</span><span class="p">:</span> <span class="p">{</span>
        <span class="nl">path</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">__dirname</span><span class="p">}</span><span class="s2">/content/projects`</span><span class="p">,</span>
        <span class="nx">name</span><span class="p">:</span> <span class="s2">`projects`</span><span class="p">,</span>
      <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">...</span>
  <span class="p">]</span>
</code></pre></div></div>

<p>Next, in <code class="language-plaintext highlighter-rouge">gatsby-node.js</code>, we don’t need to change the graphql query at all! Instead, we need to conditionally create pages and nodes based on the path to the markdown files!</p>

<p>Assuming your graphql takes the <code class="language-plaintext highlighter-rouge">fileAbsolutePath</code> field from <code class="language-plaintext highlighter-rouge">allMarkdownRemark / edges / nodes</code> like so:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">graphql</span><span class="p">(</span>
  <span class="s2">`
    {
      allMarkdownRemark(
        sort: { fields: [frontmatter___date], order: DESC }
        limit: 1000
      ) {
        edges {
          node {
            fields {
              slug
            }
            fileAbsolutePath
            frontmatter {
              title
              tags
            }
          }
        }
      }
    }
  `</span><span class="p">,</span>
<span class="p">);</span>
</code></pre></div></div>

<p>Then we can simply check this property to figure out whether to render this as a blog post or as a project post!</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">exports</span><span class="p">.</span><span class="nx">createPages</span> <span class="o">=</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">graphql</span><span class="p">,</span> <span class="nx">actions</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">blogPost</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s2">`./src/templates/BlogPost.tsx`</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">tagPage</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s2">`./src/templates/TagsPage.tsx`</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">projectPost</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s2">`./src/templates/ProjectPost.tsx`</span><span class="p">);</span>

  <span class="cm">/* graphql query from above goes here */</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">errors</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="nx">result</span><span class="p">.</span><span class="nx">errors</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Create blog posts pages.</span>
  <span class="kd">const</span> <span class="nx">posts</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">allMarkdownRemark</span><span class="p">.</span><span class="nx">edges</span><span class="p">;</span>

  <span class="nx">posts</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">post</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">previous</span> <span class="o">=</span> <span class="nx">index</span> <span class="o">===</span> <span class="nx">posts</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">?</span> <span class="kc">null</span> <span class="p">:</span> <span class="nx">posts</span><span class="p">[</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="nx">node</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">next</span> <span class="o">=</span> <span class="nx">index</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">?</span> <span class="kc">null</span> <span class="p">:</span> <span class="nx">posts</span><span class="p">[</span><span class="nx">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nx">node</span><span class="p">;</span>

    <span class="nx">createPage</span><span class="p">({</span>
      <span class="na">path</span><span class="p">:</span> <span class="nx">post</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">slug</span><span class="p">,</span>
      <span class="na">component</span><span class="p">:</span> <span class="sr">/blog/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">fileAbsolutePath</span><span class="p">)</span>
        <span class="p">?</span> <span class="nx">blogPost</span>
        <span class="p">:</span> <span class="nx">projectPost</span><span class="p">,</span>
      <span class="na">context</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">slug</span><span class="p">:</span> <span class="nx">post</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">slug</span><span class="p">,</span>
        <span class="nx">previous</span><span class="p">,</span>
        <span class="nx">next</span><span class="p">,</span>
      <span class="p">},</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Finally, to ensure slugs get properly created, we need to use <code class="language-plaintext highlighter-rouge">createFilePath</code> to create the slugs for the above command conditionally like so:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">exports</span><span class="p">.</span><span class="nx">onCreateNode</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">actions</span><span class="p">,</span> <span class="nx">getNode</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">createNodeField</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">actions</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">internal</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">`MarkdownRemark`</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">createFilePath</span><span class="p">({</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">getNode</span> <span class="p">});</span>
    <span class="nx">createNodeField</span><span class="p">({</span>
      <span class="na">name</span><span class="p">:</span> <span class="s2">`slug`</span><span class="p">,</span>
      <span class="nx">node</span><span class="p">,</span>
      <span class="na">value</span><span class="p">:</span> <span class="s2">`/</span><span class="p">${</span>
        <span class="o">/</span><span class="nx">blog</span><span class="o">/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">fileAbsolutePath</span><span class="p">)</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">blog</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">projects</span><span class="dl">'</span>
      <span class="p">}${</span><span class="nx">value</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span>
</code></pre></div></div>

<h2 id="hooking-up-the-frontend">Hooking up the frontend</h2>

<p>This is most of the “backend” work done, and the rest of the work consists of using this data. You can probably reuse the code examples given in the first resource I have linked below, or check out the <a href="https://github.com/xpire/website/tree/master/src/templates">source code for this blog you’re reading right now</a>. The harder part in my opinion was knowing how to use the absolute path in graphql in the page creation phase, as I really disliked having to label the <code class="language-plaintext highlighter-rouge">projects</code> markdown pages with an explicit field when I have already put it in its own folder.</p>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="https://desktopofsamuel.com/building-gatsby-with-multiple-post-type">building gatsby with multiple post types</a></li>
  <li><a href="https://chipcullen.com/making-multiple-content-types-in-gatsby/">making multiple content types in gatsby</a></li>
</ul>
